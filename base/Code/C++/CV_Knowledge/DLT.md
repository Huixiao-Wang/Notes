DLT（Direct Linear Transformation，直接线性变换）算法是PnP问题的一种线性求解方法。PnP问题是给定一组3D点及其在图像中的2D投影点，求解相机的位姿（旋转矩阵 $R$ 和平移向量 $t$）。DLT算法通过将PnP问题线性化，构造方程组并通过最小二乘法求解 $R$ 和 $t$。

下面我们详细推导DLT算法在PnP问题中的应用。

### 1. 相机投影模型

在相机成像模型中，世界坐标系中的3D点 $P_i = (X_i, Y_i, Z_i)^T$ 与其在图像平面上的2D投影 $p_i = (u_i, v_i)^T$ 满足以下投影关系：

$$
s \begin{bmatrix} u_i \\ v_i \\ 1 \end{bmatrix} = K [R | t] \begin{bmatrix} X_i \\ Y_i \\ Z_i \\ 1 \end{bmatrix}
$$

其中：
- $K$ 是相机内参矩阵，包含相机的焦距、主点偏移等信息。
- $R$ 是相机的旋转矩阵，$t$ 是相机的平移向量，它们共同描述了相机在世界坐标系中的位置和方向。[[旋转&平移矩阵]]
- $s$ 是一个缩放因子，用于去除投影矩阵中的尺度不确定性。

首先展开这个等式，写成显式形式：

$$
\begin{bmatrix} u_i \\ v_i \\ 1 \end{bmatrix} = \frac{1}{s} K [R | t] \begin{bmatrix} X_i \\ Y_i \\ Z_i \\ 1 \end{bmatrix}
$$

接下来，我们通过DLT的方法来解决这个投影关系。

### 2. 消去尺度因子 $s$

由于尺度因子 $s$ 是未知的，但2D图像点的坐标可以直接测量，因此我们可以通过两边的比例关系消去 $s$。假设世界坐标系中的某个点 $P_i = (X_i, Y_i, Z_i)$，其对应的图像平面坐标为 $p_i = (u_i, v_i)$。根据透视投影模型：

$$
u_i = \frac{f_x (r_{11} X_i + r_{12} Y_i + r_{13} Z_i + t_x)}{r_{31} X_i + r_{32} Y_i + r_{33} Z_i + t_z}
$$

$$
v_i = \frac{f_y (r_{21} X_i + r_{22} Y_i + r_{23} Z_i + t_y)}{r_{31} X_i + r_{32} Y_i + r_{33} Z_i + t_z}
$$

其中：
- $r_{ij}$ 是旋转矩阵 $R$ 的第 $i$ 行第 $j$ 列元素；
- $t_x, t_y, t_z$ 是平移向量 $t$ 的分量；
- $f_x, f_y$ 是相机的焦距。

为了消除 $s$，可以将上述等式改写为交叉乘积形式：

$$
(u_i (r_{31} X_i + r_{32} Y_i + r_{33} Z_i + t_z) = f_x (r_{11} X_i + r_{12} Y_i + r_{13} Z_i + t_x)
$$

$$
(v_i (r_{31} X_i + r_{32} Y_i + r_{33} Z_i + t_z) = f_y (r_{21} X_i + r_{22} Y_i + r_{23} Z_i + t_y)
$$

这是DLT算法中的核心方程。接下来，我们可以将这些方程写成线性方程组。

### 3. 构造线性方程组

现在我们将这些方程整理为矩阵形式。对于每个3D点 $P_i = (X_i, Y_i, Z_i)^T$ 及其对应的2D投影点 $p_i = (u_i, v_i)^T$，我们有两条方程：

$$
u_i (r_{31} X_i + r_{32} Y_i + r_{33} Z_i + t_z) = f_x (r_{11} X_i + r_{12} Y_i + r_{13} Z_i + t_x)
$$

$$
v_i (r_{31} X_i + r_{32} Y_i + r_{33} Z_i + t_z) = f_y (r_{21} X_i + r_{22} Y_i + r_{23} Z_i + t_y)
$$

这些方程可以通过矩阵形式写成：

$$
\begin{bmatrix}
X_i & Y_i & Z_i & 1 & 0 & 0 & 0 & 0 & -u_i X_i & -u_i Y_i & -u_i Z_i & -u_i \\
0 & 0 & 0 & 0 & X_i & Y_i & Z_i & 1 & -v_i X_i & -v_i Y_i & -v_i Z_i & -v_i
\end{bmatrix}
\begin{bmatrix}
r_{11} \\ r_{12} \\ r_{13} \\ t_x \\ r_{21} \\ r_{22} \\ r_{23} \\ t_y \\ r_{31} \\ r_{32} \\ r_{33} \\ t_z
\end{bmatrix}
=
\begin{bmatrix}
0 \\ 0
\end{bmatrix}
$$

通过这种方式，每个3D-2D点对 $P_i$ 和 $p_i$ 为我们提供两条线性方程。如果我们有 $n$ 对3D点和2D点，则可以构造出一个 $2n \times 12$ 的线性方程组：

$$
A \mathbf{h} = 0
$$

其中：
- $A$ 是 $2n \times 12$ 的系数矩阵，由3D点和2D点的坐标组成；
- $\mathbf{h}$ 是待求解的向量，包含了旋转矩阵 $R$ 和平移向量 $t$ 的元素（即 $[r_{11}, r_{12}, r_{13}, t_x, r_{21}, r_{22}, r_{23}, t_y, r_{31}, r_{32}, r_{33}, t_z]^T$）。

### 4. 最小二乘解

由于上面的方程组是齐次线性方程组 $A \mathbf{h} = 0$，可以通过**SVD 奇异值分解**求解。基本步骤如下：

1. 对矩阵 $A$ 进行奇异值分解，得到 $A = U \Sigma V^T$。
2. 取 $V$ 中对应最小奇异值的列向量，作为解向量 $\mathbf{h}$。
3. 解向量 $\mathbf{h}$ 即包含了旋转矩阵 $R$ 和平移向量 $t$。

### 5. 解的分解

从求得的向量 $\mathbf{h}$ 中，我们可以恢复相机的旋转矩阵 $R$ 和平移向量 $t$。由于 $R$ 是正交矩阵，通常在分解后还需要通过正交化（如Gram-Schmidt方法）对 $R$ 进行校正，使其满足正交性约束。

### 6. 总结

DLT算法的主要思想是将PnP问题中的投影方程线性化，构造出齐次线性方程组，并使用最小二乘法求解。具体步骤如下：

1. 根据3D点和2D点构造投影方程，消除尺度因子 $s$。
2. 将这些方程表示为线性方程组。
3. 通过SVD求解该方程组，获得旋转矩阵 $R$ 和平移向量 $t$。

DLT是一种直接线性方法，优点是简单高效，但由于忽略了噪声的影响，通常精度不如非线性优化方法如Levenberg-Marquardt优化高。